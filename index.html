<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="theme-color" content="#6366f1" />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: dark)"
      content="#4f46e5"
    />

    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="EMI Tracker" />

    <!-- Manifest -->
    <link rel="manifest" href="./manifest.json" />

    <!-- Favicon and Apple Touch Icons -->
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="./icon-192.png" />
    <link rel="stylesheet" href="./index.css" />
    <title>EMI & Expense Tracker</title>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <h1>ğŸ’³ EMI & Expense Tracker<span id="sealedBadge" class="sealed-badge" style="display: none;">ğŸ”’ SEALED</span></h1>
        <div class="header-subtitle">
          Manage your EMIs and expenses offline, securely
        </div>
        <div class="header-actions">
          <button id="installButton" class="install-btn" style="display: none">
            <span class="install-icon">ğŸ“²</span>
            <span>Install</span>
          </button>
          <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()">
            <span id="themeIcon">ğŸŒ™</span>
            <span id="themeText">Dark</span>
          </button>
          <button
            class="data-btn"
            onclick="document.getElementById('importFile').click()"
          >
            ğŸ“¥ Import
          </button>
          <button class="data-btn" onclick="showExportWarning()" id="export">ğŸ“¤ Export</button>
          <button class="info-btn" onclick="showExportInfo()" 
                  title="Important: Backup Information">
            ?
          </button>
          <button class="info-btn" onclick="showDataConsistencyInfo()" 
                  title="Important: Data Consistency Notice"
                  style="margin-left: 4px;">
            âš ï¸
          </button>
          <a href="https://github.com/dhuruvandb/EMI-And-Expense-calculator" 
             target="_blank" 
             rel="noopener noreferrer" 
             class="info-btn github-btn" 
             title="View on GitHub"
             style="margin-right: 8px; text-decoration: none;">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
          </a>
          <input
            type="file"
            id="importFile"
            accept=".json"
            style="display: none"
            onchange="importData(event)"
          />
        </div>
      </div>
    </div>

    <!-- Summary Section -->
    <div class="summary-section">
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-label">Total Items</div>
          <div class="summary-value" id="totalEMIs">0</div>
        </div>
        <div class="summary-card warning">
          <div class="summary-label">Monthly Payment</div>
          <div class="summary-value" id="totalMonthly">â‚¹0</div>
          <div class="summary-breakdown" id="monthlyBreakdown"></div>
        </div>
        <div class="summary-card success">
          <div class="summary-label">Total Debt</div>
          <div class="summary-value" id="totalDebt">â‚¹0</div>
        </div>
        <div class="summary-card freedom" id="freedomCard" style="display: none;" onclick="openFreedomModal()">
          <div class="summary-label">ğŸ¯ Debt-Free Date</div>
          <div class="summary-value freedom-date" id="freedomDateSummary">-</div>
          <div class="freedom-countdown-badge-summary">
            <span id="freedomCountdownSummary">-</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Freedom Timeline Modal -->
    <div id="freedomModal" class="modal">
      <div class="modal-content freedom-modal">
        <div class="modal-header">
          <h2>ğŸ¯ Financial Freedom Timeline</h2>
          <button class="close-btn" onclick="closeFreedomModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="freedom-modal-highlight">
            <div class="freedom-modal-card">
              <div class="freedom-modal-label">FREEDOM DATE</div>
              <div class="freedom-modal-date" id="freedomDateModal">-</div>
              <div class="freedom-modal-countdown" id="freedomCountdownModal">-</div>
            </div>
          </div>
          
          <div class="freedom-modal-section">
            <h3 class="freedom-modal-title">ğŸ“… Upcoming Milestones</h3>
            <div class="freedom-milestones-list" id="freedomMilestonesList">
              <!-- Milestones will be inserted here -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="closeFreedomModal()">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <input
        type="text"
        id="searchInput"
        class="search-input"
        placeholder="ğŸ” Search by name or amount..."
        oninput="handleSearch()"
      />
    </div>

    <!-- Sort & Filter Controls -->
    <div class="sort-controls">
      <div class="sort-bar">
        <div class="sort-group">
          <span class="sort-label">Sort By:</span>
          <select
            id="sortBy"
            class="sort-select"
            onchange="applySortAndGroup()"
          >
            <option value="entry">Entry Order</option>
            <option value="dueDate">Due Date</option>
            <option value="amount">Amount</option>
            <option value="endDate">End Date</option>
            <option value="periodLeft">Period Left</option>
            <option value="name">Name (A-Z)</option>
            <option value="type">Type</option>
            <option value="category">Category</option>
          </select>
          <button
            id="sortDirection"
            class="sort-direction-btn"
            onclick="toggleSortDirection()"
            title="Sort Direction"
          >
            â†‘
          </button>
        </div>
        <div class="sort-group">
          <span class="sort-label">Group By:</span>
          <select
            id="groupBy"
            class="sort-select"
            onchange="applySortAndGroup()"
          >
            <option value="none">No Grouping</option>
            <option value="category">Category</option>
            <option value="type">Type</option>
            <option value="dueDateRange">Due Date Range</option>
            <option value="status">Status</option>
          </select>
        </div>
        <div class="sort-group">
          <button class="view-toggle-btn" onclick="toggleArchivedView()">
            <span id="viewToggleText">ğŸ“¦ View Archive</span>
          </button>
        </div>
        <div class="sort-group">
          <button class="seal-control-btn" id="sealControlBtn" 
                  onclick="initiateSeal()" disabled 
                  title="Check at least one payment to enable">
            ğŸ”’ Seal
          </button>
          <button class="info-btn" onclick="showSealInfo()" 
                  title="Learn about Seal Mode">
            ?
          </button>
        </div>
      </div>
    </div>

    <!-- Table Section -->
    <div class="table-container">
      <div class="table-wrapper" id="tableWrapper">
        <div class="table-scroll">
          <table id="emiTable">
            <thead>
              <tr>
                <th class="checkbox-col">Paid</th>
                <th class="mandatory">Type</th>
                <th class="mandatory">Name</th>
                <th class="mandatory">Amount</th>
                <th class="mandatory">Due Date</th>
                <th class="mandatory">End Date</th>
                <th class="mandatory">Period Left</th>
                <th class="optional">Total Amount</th>
                <th class="optional">Principal Paid</th>
                <th class="optional">Interest Paid</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="emiTableBody">
              <!-- EMI rows will be inserted here -->
            </tbody>
          </table>
        </div>
        <div id="emptyState" class="empty-state" style="display: none">
          <div class="empty-state-icon">ğŸ“‹</div>
          <h3>No Items Added Yet</h3>
          <p>Tap the + button below to add your first EMI or expense</p>
        </div>
      </div>
    </div>

    <!-- FAB Button -->
    <button class="fab" onclick="openModal()" aria-label="Add Item">+</button>

    <!-- Seal Confirmation Modal -->
    <div id="sealModal" class="modal">
      <div class="modal-content seal-modal">
        <div class="modal-header">
          <h2>âš ï¸ Seal Monthly Payments?</h2>
          <button class="close-btn" onclick="closeSealModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="seal-warning-box">
            <p class="seal-warning-title">This will LOCK all payments until:</p>
            <p class="seal-date" id="sealUntilDate">ğŸ“… February 1, 2026</p>
          </div>
          <ul class="seal-consequences">
            <li>âœ… Payments cannot be edited</li>
            <li>âœ… Checkboxes cannot be changed</li>
            <li>âœ… Status is permanent this month</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeSealModal()">Cancel</button>
          <button class="btn btn-danger" onclick="confirmSeal()">CONFIRM SEAL</button>
        </div>
      </div>
    </div>

    <!-- Seal Info Modal -->
    <div id="sealInfoModal" class="modal">
      <div class="modal-content info-modal">
        <div class="modal-header">
          <h2>â„¹ï¸ About Seal Mode</h2>
          <button class="close-btn" onclick="closeSealInfoModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="info-warning">
            <p>âš ï¸ <strong>This is a serious commitment</strong></p>
          </div>
          
          <div class="info-section">
            <h3>â±ï¸ What Happens When You Seal:</h3>
            <ol class="info-steps">
              <li><strong>3-second countdown</strong> - Last chance to press STOP</li>
              <li><strong>5-second undo period</strong> - Final window to press UNDO</li>
              <li><strong>Total: 8 seconds of deliberation</strong></li>
            </ol>
          </div>
          
          <div class="info-section">
            <h3>ğŸ”’ During These 8 Seconds:</h3>
            <ul class="info-restrictions">
              <li>âŒ Cannot edit items</li>
              <li>âŒ Cannot check/uncheck payments</li>
              <li>âŒ Cannot delete items</li>
              <li>âŒ Cannot add new items</li>
            </ul>
          </div>
          
          <div class="info-section">
            <h3>âœ… After Sealing:</h3>
            <ul class="info-benefits">
              <li>ğŸ”’ All payments locked until next month</li>
              <li>ğŸ›¡ï¸ Protected from accidental touches</li>
              <li>ğŸ§˜ Financial peace of mind achieved</li>
              <li>ğŸ“… Auto-unlocks on the 1st of next month</li>
            </ul>
          </div>
          
          <div class="info-caution">
            <p><strong>Use wisely. This is a one-way action for this month.</strong></p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="closeSealInfoModal()">
            Got It!
          </button>
        </div>
      </div>
    </div>

    <!-- Export Warning Modal -->
    <div id="exportWarningModal" class="modal">
      <div class="modal-content info-modal">
        <div class="modal-header">
          <h2>âš ï¸ Important: Before Exporting</h2>
          <button class="close-btn" onclick="closeExportWarning()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="info-warning">
            <p>âš ï¸ <strong>DO NOT edit the exported backup file!</strong></p>
          </div>
          
          <div class="info-section">
            <h3>ğŸš¨ Critical Rules:</h3>
            <ul class="info-restrictions">
              <li>âŒ <strong>Never open in text editor</strong> - Don't modify the JSON file</li>
              <li>âŒ <strong>Never change file extension</strong> - Keep it as .json</li>
              <li>âŒ <strong>Never rename incorrectly</strong> - Original name is best</li>
              <li>âŒ <strong>Edited/corrupted files WILL FAIL import</strong> - You'll lose data!</li>
            </ul>
          </div>
          
          <div class="info-section">
            <h3>âœ… What You SHOULD Do:</h3>
            <ul class="info-steps">
              <li><strong>Download and store safely</strong> - Don't touch the file contents</li>
              <li><strong>Email to yourself</strong> - Multiple copies = safer</li>
              <li><strong>Upload to cloud storage</strong> - Google Drive, Dropbox, etc.</li>
              <li><strong>Keep multiple backups</strong> - Export monthly for safety</li>
            </ul>
          </div>
          
          <div class="info-caution">
            <p><strong>ğŸ’¡ The file works perfectly as-is. Leave it alone and you're safe!</strong></p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeExportWarning()">
            Cancel
          </button>
          <button class="btn btn-primary" onclick="closeExportWarning(); exportData();">
            ğŸ“¤ I Understand, Export Now
          </button>
        </div>
      </div>
    </div>

    <!-- Export Info Modal -->
    <div id="exportInfoModal" class="modal">
      <div class="modal-content info-modal">
        <div class="modal-header">
          <h2>âš ï¸ Data Backup Warning</h2>
          <button class="close-btn" onclick="closeExportInfoModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="info-warning">
            <p>âš ï¸ <strong>Your data is stored locally in your browser!</strong></p>
          </div>
          
          <div class="info-section">
            <h3>ğŸš¨ Risk of Data Loss:</h3>
            <ul class="info-restrictions">
              <li>âŒ Clearing browser cache/data will delete everything</li>
              <li>âŒ Browser updates may reset local storage</li>
              <li>âŒ Using incognito/private mode won't save data</li>
              <li>âŒ Switching devices means starting fresh</li>
              <li>âŒ Uninstalling the app removes all records</li>
            </ul>
          </div>
          
          <div class="info-section">
            <h3>âœ… How to Protect Your Data:</h3>
            <ul class="info-benefits">
              <li>ğŸ’¾ <strong>Export regularly</strong> - Click "ğŸ“¤ Export" to save a backup</li>
              <li>ğŸ“§ Email the backup file to yourself</li>
              <li>â˜ï¸ Store it in cloud storage (Google Drive, Dropbox, etc.)</li>
              <li>ğŸ“± Keep backups on multiple devices</li>
              <li>ğŸ”„ Make it a monthly habit after sealing payments</li>
            </ul>
          </div>
          
          <div class="info-section">
            <h3>ğŸš« Critical: DO NOT Edit the Backup File!</h3>
            <p style="color: var(--text-secondary); line-height: 1.6; margin: 0;">
              <strong style="color: #ef4444;">âš ï¸ Never modify the exported JSON file at any cost!</strong> Even a single character change will corrupt it and make import fail. The file works perfectly as-is - store it safely without opening or editing it.
            </p>
          </div>
          
          <div class="info-caution">
            <p><strong>ğŸ’¡ Pro Tip: Export after every major update or at month-end!</strong></p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeExportInfoModal()">
            Got It
          </button>
          <button class="btn btn-primary" onclick="closeExportInfoModal(); exportData();">
            ğŸ“¤ Export Now
          </button>
        </div>
      </div>
    </div>

    <!-- Data Consistency Info Modal -->
    <div id="dataConsistencyModal" class="modal">
      <div class="modal-content info-modal">
        <div class="modal-header">
          <h2>âš ï¸ Data Consistency Notice</h2>
          <button class="close-btn" onclick="closeDataConsistencyInfo()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="info-warning">
            <p>âš ï¸ <strong>This app stores data locally for your privacy</strong></p>
          </div>
          
          <div class="info-section">
            <h3>ğŸ”’ Privacy by Design:</h3>
            <ul class="info-benefits">
              <li>âœ… No servers - your data never leaves your device</li>
              <li>âœ… No cloud sync - complete privacy control</li>
              <li>âœ… No accounts - no sign-up required</li>
              <li>âœ… 100% offline - works without internet FOREVER</li>
            </ul>
          </div>
          
          <div class="info-section">
            <h3>âš ï¸ Important Implications:</h3>
            <ul class="info-restrictions">
              <li>âŒ <strong>No automatic sync across devices</strong> - Use Export/Import</li>
              <li>âŒ <strong>No server-side validation</strong> - You're responsible for accuracy</li>
              <li>âŒ <strong>No automatic backups</strong> - Export regularly yourself</li>
              <li>âŒ <strong>No data recovery</strong> - If deleted, it's gone forever</li>
            </ul>
          </div>
          
          <div class="info-section">
            <h3>âœ… Your Responsibility:</h3>
            <ul class="info-steps">
              <li><strong>Verify your entries</strong> - Double-check amounts and dates every month</li>
              <li><strong>Export regularly</strong> - Keep backups safe</li>
              <li><strong>Reconcile manually</strong> - Cross-check with bank statements</li>
              <li><strong>Accept the trade-off</strong> - Privacy means self-management</li>
            </ul>
          </div>
          
          <div class="info-caution">
            <p><strong>ğŸ’¡ We chose privacy over convenience. Your data stays yours, always.</strong></p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="closeDataConsistencyInfo()">
            I Understand
          </button>
        </div>
      </div>
    </div>

    <!-- Import Confirmation Modal -->
    <div id="importConfirmModal" class="modal">
      <div class="modal-content info-modal">
        <div class="modal-header">
          <h2>ğŸ“¥ Confirm Import</h2>
          <button class="close-btn" onclick="closeImportConfirmModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="info-section">
            <h3>ğŸ“¦ Import Summary:</h3>
            <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin: 12px 0;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="color: var(--text-secondary);">Active Items:</span>
                <strong id="importActiveCount" style="color: var(--primary-color); font-size: 1.1rem;">0</strong>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-secondary);">Archived Items:</span>
                <strong id="importArchivedCount" style="color: var(--text-secondary); font-size: 1.1rem;">0</strong>
              </div>
            </div>
          </div>
          
          <div class="info-warning" id="importMonthWarning" style="display: none;">
            <p>âš ï¸ <strong>Export is from a different month</strong></p>
            <p style="margin-top: 8px; font-size: 0.9rem;">All payments and seal status will be reset for the new month.</p>
          </div>
          
          <div class="info-section">
            <h3>â„¹ï¸ What Will Happen:</h3>
            <ul class="info-steps">
              <li><strong>Data will be added</strong> - Merges with your existing data</li>
              <li><strong>No data loss</strong> - Your current items remain untouched</li>
              <li><strong>Duplicates possible</strong> - Check for duplicate entries after import</li>
            </ul>
          </div>
          
          <div class="info-caution">
            <p><strong>ğŸ’¡ You can always export a backup before proceeding!</strong></p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeImportConfirmModal()">
            Cancel
          </button>
          <button class="btn btn-primary" onclick="confirmImport()">
            ğŸ“¥ Import Now
          </button>
        </div>
      </div>
    </div>

    <!-- Import Error Modal -->
    <div id="importErrorModal" class="modal">
      <div class="modal-content info-modal">
        <div class="modal-header">
          <h2>ğŸš¨ Cannot Import Backup File</h2>
          <button class="close-btn" onclick="closeImportErrorModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="info-warning">
            <p id="importErrorTitle">âš ï¸ <strong>The backup file appears to be corrupted or invalid</strong></p>
          </div>
          
          <div class="info-section">
            <h3>ğŸ“‹ Common Causes:</h3>
            <ul class="info-restrictions" id="importErrorCauses">
              <li>âŒ File was downloaded incompletely</li>
              <li>âŒ Manually edited in text editor</li>
              <li>âŒ Wrong file selected (not from this app)</li>
              <li>âŒ File corrupted during transfer</li>
            </ul>
          </div>
          
          <div class="info-section">
            <h3>âœ… What to Do:</h3>
            <ul class="info-steps">
              <li><strong>Try a different backup file</strong> - Use an older backup</li>
              <li><strong>Export fresh backup</strong> - From a working device</li>
              <li><strong>Check file size</strong> - Should be at least 100 bytes</li>
              <li><strong>Don't manually edit</strong> - JSON files are fragile</li>
            </ul>
          </div>
          
          <div class="info-section" id="technicalDetailsSection" style="display: none;">
            <h3>ğŸ”§ Technical Details:</h3>
            <div style="background: var(--bg-secondary); padding: 12px; border-radius: 6px; font-family: monospace; font-size: 0.85rem; overflow-x: auto;">
              <div><strong>Error Type:</strong> <span id="errorType">-</span></div>
              <div><strong>Error Message:</strong> <span id="errorMessage">-</span></div>
              <div><strong>File Size:</strong> <span id="fileSize">-</span></div>
            </div>
          </div>
          
          <div class="info-caution">
            <p><strong>ğŸ’¡ Your existing data (if any) is safe - nothing was changed.</strong></p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="toggleTechnicalDetails()">
            <span id="techDetailsToggle">Show Technical Details â–¼</span>
          </button>
          <button class="btn btn-primary" onclick="closeImportErrorModal()">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div id="emiModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">Add New Item</h2>
          <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="emiForm">
            <!-- Type Toggle -->
            <div class="type-toggle">
              <div class="type-option">
                <input
                  type="radio"
                  id="typeEMI"
                  name="itemType"
                  value="emi"
                  checked
                  onchange="toggleFormFields()"
                />
                <label for="typeEMI">
                  <span class="type-badge">ğŸ’³</span>
                  <span>EMI</span>
                </label>
              </div>
              <div class="type-option">
                <input
                  type="radio"
                  id="typeExpense"
                  name="itemType"
                  value="expense"
                  onchange="toggleFormFields()"
                />
                <label for="typeExpense">
                  <span class="type-badge">ğŸ </span>
                  <span>Constant Expense</span>
                </label>
              </div>
            </div>

            <!-- Mandatory Fields -->
            <div class="form-section">
              <div class="form-section-title">
                <span>Mandatory Information</span>
                <span class="required-badge">REQUIRED</span>
              </div>

              <div class="form-group">
                <label for="emiCategory"
                  >Category <span class="required">*</span></label
                >
                <select
                  id="emiCategory"
                  required
                  onchange="toggleCategoryFields()"
                >
                  <option value="expense" id="categoryExpenseOption">
                    Expense/Debt
                  </option>
                  <option value="savings">Savings</option>
                </select>
              </div>

              <div class="form-group">
                <label for="emiName" id="nameLabel"
                  >Name <span class="required">*</span></label
                >
                <input
                  type="text"
                  id="emiName"
                  required
                  placeholder="e.g., Home Loan, Car EMI"
                />
              </div>

              <div class="form-group">
                <label for="emiAmount" id="amountLabel"
                  >Monthly Amount (â‚¹) <span class="required">*</span></label
                >
                <input
                  type="number"
                  id="emiAmount"
                  required
                  placeholder="e.g., 5000"
                  step="0.01"
                  min="1"
                  max="100000000"
                />
              </div>

              <div class="form-group">
                <label for="dueDate"
                  >Monthly Due Date <span class="required">*</span></label
                >
                <input
                  type="number"
                  id="dueDate"
                  required
                  placeholder="e.g., 5"
                  min="1"
                  max="31"
                />
                <div class="helper-text">Day of the month (1-31)</div>
              </div>

              <div class="form-group" id="endDateGroup">
                <label for="emiEndDate" id="endDateLabel">
                  End Date <span class="required" id="endDateRequired">*</span>
                </label>
                <input type="date" id="emiEndDate" />
                <div
                  class="helper-text"
                  id="endDateHelper"
                  style="display: none"
                >
                  Optional for ongoing expenses like rent
                </div>
              </div>
            </div>

            <!-- Optional Fields (EMI Only) -->
            <div
              class="form-section field-conditional active"
              id="emiOnlyFields"
            >
              <div class="form-section-title">
                <span>EMI Details</span>
                <span class="optional-badge">OPTIONAL</span>
              </div>

              <div class="form-group">
                <label for="totalAmount">Total Amount Bought (â‚¹)</label>
                <input
                  type="number"
                  id="totalAmount"
                  placeholder="e.g., 500000"
                  step="0.01"
                  min="0"
                  max="1000000000"
                />
              </div>

              <div class="form-group">
                <label for="principalPaid">Principal Paid (â‚¹)</label>
                <input
                  type="number"
                  id="principalPaid"
                  placeholder="e.g., 50000"
                  step="0.01"
                  min="0"
                  max="1000000000"
                />
              </div>

              <div class="form-group">
                <label for="interestPaid">Interest Paid (â‚¹)</label>
                <input
                  type="number"
                  id="interestPaid"
                  placeholder="e.g., 10000"
                  step="0.01"
                  min="0"
                  max="1000000000"
                />
              </div>
            </div>

            <input type="hidden" id="editIndex" value="" />
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeModal()"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            form="emiForm"
            id="submitBtn"
          >
            Add Item
          </button>
        </div>
      </div>
    </div>

    <!-- Payment Success Toast -->
    <div id="paymentToast" class="payment-toast"></div>
    <div id="superToast" class="super-toast">
      ğŸ’š Fully paid up! No stress, no worries, no surprises. This is what
      financial peace feels like. Well done! â˜®ï¸
    </div>

    <!-- Seal Toast Notifications -->
    <div id="countdownToast" class="seal-toast countdown-toast">
      <span id="countdownText">â³ Sealing... (3s)</span>
      <button class="toast-btn" onclick="abortSeal()">STOP</button>
    </div>

    <div id="undoToast" class="seal-toast undo-toast">
      <span id="undoText">âœ… Sealed! (5s)</span>
      <button class="toast-btn" onclick="undoSeal()">UNDO</button>
    </div>
    
    <!-- Sealing Overlay -->
    <div id="sealingOverlay" class="sealing-overlay"></div>

    <script src="./script.js"></script>
  </body>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker
        .register("./sw.js")
        .then(function (registration) {
          console.log(
            "Service Worker registered with scope:",
            registration.scope
          );
        })
        .catch(function (error) {
          console.log("Service Worker registration failed:", error);
        });
    }
  </script>
  <script>
    let deferredPrompt;
    const installButton = document.getElementById("installButton");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installButton.style.display = "inline-flex";
    });

    installButton.addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const choiceResult = await deferredPrompt.userChoice;
      deferredPrompt = null;
      installButton.style.display = "none";
    });
  </script>
</html>
